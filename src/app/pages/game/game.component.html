<main class="container py-4" *ngIf="juego">
  <!-- Cabecera del juego -->
  <div class="mb-4">
    <div class="card game-header text-white d-flex flex-row">
      <img
        [src]="juego.imagen"
        [alt]="juego.titulo"
        class="game-cover"
      />

      <div class="card-body d-flex flex-column justify-content-center">
        <h1 class="h4 mb-2">{{ juego.titulo }}</h1>
        <p class="mb-1">
          {{ juego.genero }} • {{ juego.anio }}
        </p>
        <p class="mb-0">
          <span>Rating comunidad:</span>
          <span class="fw-bold ms-1">{{ juego.rating }}</span>
          <span class="text-warning ms-2">
            ★ ★ ★ ★ ★
          </span>
        </p>
      </div>
    </div>
  </div>

  <!-- Reseñas + Formulario -->
  <div class="row g-4">
    <!-- Lista de reseñas -->
    <div class="col-12 col-lg-6">
      <h2 class="h5">Reseñas ({{ cantidadResenasVisibles }})</h2>

      <div class="card resenas-card text-white h-100 p-3">
        <p class="text-muted mb-0" *ngIf="cantidadResenasVisibles === 0">
          Aún no hay reseñas visibles para este juego.
        </p>

        <div
          class="mb-3 pb-3 border-bottom border-secondary"
          *ngFor="let r of (esAdmin ? resenas : resenasVisibles); let last = last"
          [class.border-0]="last"
        >
          <div
            class="d-flex justify-content-between align-items-start mb-1"
          >
            <div>
              <strong>{{ r.email }}</strong>
              <span class="ms-2 text-warning">★ {{ r.puntaje }}</span>
              <span
                *ngIf="esAdmin && !r.visible"
                class="badge bg-secondary ms-2"
              >
                Oculta
              </span>
            </div>

            <div
              *ngIf="esAdmin"
              class="btn-group btn-group-sm"
            >
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="toggleVisibilidad(r.id)"
              >
                {{ r.visible ? 'Ocultar' : 'Mostrar' }}
              </button>
              <button
                type="button"
                class="btn btn-outline-danger"
                (click)="eliminarResena(r.id)"
              >
                Eliminar
              </button>
            </div>
          </div>

          <!-- El comentario solo se muestra si está visible-->
          <p class="mb-0" *ngIf="r.visible || esAdmin">
            {{ r.comentario }}
          </p>
        </div>
      </div>
    </div>

    <!-- Formulario para agregar reseña -->
    <div class="col-12 col-lg-6">
      <h2 class="h5">Agregar reseña</h2>

      <!-- Mensaje cuando NO está logueado -->
      <div
        *ngIf="!puedeComentar"
        class="alert alert-warning py-2 small"
      >
        Para dejar un comentario debes estar registrado e iniciar sesión
        en PixelHoshi. Usa la opción "Ingresar" o "Registrarse" del menú superior.
      </div>

      <form [formGroup]="formResena" (ngSubmit)="publicar()" novalidate>
        <div class="mb-3">
          <label class="form-label">Puntaje</label>
          <select
            class="form-select"
            formControlName="puntaje"
            [disabled]="!puedeComentar"
          >
            <option value="" disabled>Elige una opción</option>
            <option
              *ngFor="let p of opcionesPuntaje"
              [value]="p"
            >
              {{ p }}
            </option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Comentario</label>
          <textarea
            rows="5"
            class="form-control"
            formControlName="comentario"
            [disabled]="!puedeComentar"
          ></textarea>
        </div>
<p>Debe contener un largo minimo de 15 caracteres</p>
        <button
          type="submit"
          class="btn btn-success"
          [disabled]="!puedeComentar || formResena.invalid"
        >
          Publicar
        </button>
      </form>
    </div>
  </div>
</main>
